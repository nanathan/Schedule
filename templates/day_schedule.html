<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Schedule | {{ day_label }}</title>
    <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
<div class="wrapper">
    <header class="top">
        <div class="title">
            <h1>{{ day_label }}</h1>
            <p>{{ events|length }} events planned • {{ total_minutes }} total minutes scheduled</p>
        </div>
    </header>

    <main class="content">
        <section class="card">
            <div class="day-header">
                <h2>Daily schedule</h2>
                <a href="{{ url_for('home') }}" class="button secondary">Back to month view</a>
            </div>

            {% if events %}
            <ul class="event-list" aria-label="Events for {{ day_label }}">
                {% for event in events %}
                <li class="event-item">
                    {% if editing_event_index == loop.index0 %}
                    <h3>Edit event</h3>

                    {% if error_message %}
                    <p class="form-error" role="alert">{{ error_message }}</p>
                    {% endif %}

                    <form method="post" class="event-form event-form--inline">
                        <input type="hidden" name="action" value="update">
                        <input type="hidden" name="event_index" value="{{ loop.index0 }}">

                        <label for="event-title-{{ loop.index0 }}">Title</label>
                        <input id="event-title-{{ loop.index0 }}" name="title" type="text" required value="{{ editing_form_values.title if editing_form_values else event.title }}">

                        <label for="event-start-{{ loop.index0 }}">Start time</label>
                        <input id="event-start-{{ loop.index0 }}" name="start" type="time" required value="{{ editing_form_values.start if editing_form_values else event.start }}">

                        <label for="event-duration-{{ loop.index0 }}">Duration (minutes)</label>
                        <input id="event-duration-{{ loop.index0 }}" name="duration_minutes" type="number" min="1" required value="{{ editing_form_values.duration_minutes if editing_form_values else event.duration_minutes }}">

                        <label for="event-notes-{{ loop.index0 }}">Notes</label>
                        <textarea id="event-notes-{{ loop.index0 }}" name="notes" rows="3" placeholder="Optional details">{{ editing_form_values.notes if editing_form_values else event.notes }}</textarea>

                        <label for="event-day-{{ loop.index0 }}">Date</label>
                        <input id="event-day-{{ loop.index0 }}" name="target_day" type="date" required value="{{ editing_form_values.target_day if editing_form_values else day }}">

                        <div class="event-actions">
                            <button type="submit" class="button primary">Save changes</button>
                            <a class="button secondary" href="{{ url_for('day_schedule', day=day) }}">Cancel</a>
                        </div>
                    </form>
                    {% else %}
                    <p class="event-time">Starts {{ event.start }}</p>
                    <h3>{{ event.title }}</h3>
                    <p class="event-duration">Duration: {{ event.duration_minutes }} minutes</p>
                    <p class="event-notes">{{ event.notes }}</p>

                    <div class="event-actions">
                        <a href="{{ url_for('day_schedule', day=day, edit_event=loop.index0) }}" class="button secondary">Edit event</a>
                        <form method="post" class="delete-form delete-form--inline">
                            <input type="hidden" name="action" value="delete">
                            <input type="hidden" name="event_index" value="{{ loop.index0 }}">
                            <button type="submit" class="button danger">Delete event</button>
                        </form>
                    </div>
                    {% endif %}
                </li>
                {% endfor %}
            </ul>
            {% else %}
            <p class="empty-state">No events are scheduled for this day yet.</p>
            {% endif %}

            <section class="event-form-section" aria-labelledby="add-event-heading">
                <h3 id="add-event-heading">Add an event</h3>

                {% if error_message and editing_event_index is none %}
                <p class="form-error" role="alert">{{ error_message }}</p>
                {% endif %}

                <form method="post" class="event-form">
                    <label for="title">Title</label>
                    <input id="title" name="title" type="text" required value="{{ form_values.title }}">

                    <label for="start">Start time</label>
                    <input id="start" name="start" type="time" required value="{{ form_values.start }}">

                    <label for="duration_minutes">Duration (minutes)</label>
                    <input id="duration_minutes" name="duration_minutes" type="number" min="1" required value="{{ form_values.duration_minutes }}">

                    <label for="notes">Notes</label>
                    <textarea id="notes" name="notes" rows="3" placeholder="Optional details">{{ form_values.notes }}</textarea>

                    <button type="submit" class="button primary">Add event</button>
                </form>
            </section>
        </section>
    </main>
</div>

<footer>
    <p>Built with Flask • Your day, planned better.</p>
</footer>
</body>
</html>
